<p><img src="http://7xqhhm.com1.z0.glb.clouddn.com/images/airline-weather-vim-screenshot.png" alt="screenshot" /></p>

<p>这两天把 Vim 的 Powerline 插件换成了 <a href="https://github.com/bling/vim-airline">vim-airline</a>, 相比 Powerline, vim-airline 更轻量, 完全用 Vimscript 实现, 让我摆脱了 Vim 中的 Powerline 插件在我的 tmux 环境下经常闪烁的问题.</p>

<p>但是 vim-airline 缺了 Powerline 插件的天气扩展, 于是自己写了一个 vim-airline 的天气扩展, 效果图如上, 在右下角显示天气图标和当前温度, 借助了 webapi-vim 插件和 OpenWeatherMap 的 API.</p>

<p>Github Repo 地址: <a href="https://github.com/Wildog/airline-weather.vim">https://github.com/Wildog/airline-weather.vim</a></p>

<h2 id="section">安装</h2>

<ul>
  <li>
    <h3 id="vundle-">使用 Vundle 安装</h3>
  </li>
</ul>

<p>扩展依赖 vim-airline 和 webapi-vim, 确保你的 .vimrc 中有以下几行:</p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim">Plugin <span class="s1">'bling/vim-airline'</span>
Plugin <span class="s1">'mattn/webapi-vim'</span>
Plugin <span class="s1">'Wildog/airline-weather.vim'</span></code></pre></figure>

<p>然后执行 <code class="highlighter-rouge">:PluginInstall</code></p>

<h2 id="section-1">自定义</h2>

<ul>
  <li>
    <h3 id="section-2">设置位置</h3>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> <span class="nv">g:weather</span>#area <span class="p">=</span> <span class="s1">'beijing,china'</span></code></pre></figure>

<ul>
  <li>
    <h3 id="section-3">设置单位</h3>
  </li>
</ul>

<p>metric 为摄氏度, imperial 为华氏度</p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> <span class="nv">g:weather</span>#unit <span class="p">=</span> <span class="s1">'metric'</span></code></pre></figure>

<ul>
  <li>
    <h3 id="api-key">设置 API Key</h3>
  </li>
</ul>

<p>默认为我的 API Key, 你最好申请并设置一个自己的 API Key: <a href="http://openweathermap.org/appid">http://openweathermap.org/appid</a></p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> <span class="nv">g:weather</span>#appid <span class="p">=</span> <span class="s1">'2de143494c0b295cca9337e1e96b00e0'</span></code></pre></figure>

<ul>
  <li>
    <h3 id="section-4">设置缓存</h3>
  </li>
</ul>

<p>缓存文件路径默认为<code class="highlighter-rouge">~/.cache/.weather</code>, 更新周期默认为 1 小时. 如果要修改更新周期, 注意更新太过频繁会使 Vim 卡顿.</p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> <span class="nv">g:weather</span>#cache_file <span class="p">=</span> <span class="s1">'~/.cache/.weather'</span>
<span class="k">let</span> <span class="nv">g:weather</span>#cache_ttl <span class="p">=</span> <span class="s1">'3600'</span></code></pre></figure>

<ul>
  <li>
    <h3 id="section-5">设置格式</h3>
  </li>
</ul>

<p><code class="highlighter-rouge">%s</code>为天气图标, <code class="highlighter-rouge">%f</code>为温度数字</p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> <span class="nv">g:weather</span>#format <span class="p">=</span> <span class="s1">'%s %.0f'</span></code></pre></figure>

<ul>
  <li>
    <h3 id="section-6">设置图标</h3>
  </li>
</ul>

<p>各图标数字代码含义可参考 OpenWeatherMap 的 API: <a href="http://openweathermap.org/weather-conditions">http://openweathermap.org/weather-conditions</a></p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> <span class="nv">g:weather</span>#status_map <span class="p">=</span> <span class="p">{</span>
<span class="se">\</span> <span class="s2">"01d"</span><span class="p">:</span> <span class="s2">"☀"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"02d"</span><span class="p">:</span> <span class="s2">"☁"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"03d"</span><span class="p">:</span> <span class="s2">"☁"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"04d"</span><span class="p">:</span> <span class="s2">"☁"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"09d"</span><span class="p">:</span> <span class="s2">"☂"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"10d"</span><span class="p">:</span> <span class="s2">"☂"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"11d"</span><span class="p">:</span> <span class="s2">"☈"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"13d"</span><span class="p">:</span> <span class="s2">"❅"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"50d"</span><span class="p">:</span> <span class="s2">"≡"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"01n"</span><span class="p">:</span> <span class="s2">"☽"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"02n"</span><span class="p">:</span> <span class="s2">"☁"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"03n"</span><span class="p">:</span> <span class="s2">"☁"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"04n"</span><span class="p">:</span> <span class="s2">"☁"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"09n"</span><span class="p">:</span> <span class="s2">"☂"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"10n"</span><span class="p">:</span> <span class="s2">"☂"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"11n"</span><span class="p">:</span> <span class="s2">"☈"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"13n"</span><span class="p">:</span> <span class="s2">"❅"</span><span class="p">,</span>
<span class="se">\</span> <span class="s2">"50n"</span><span class="p">:</span> <span class="s2">"≡"</span><span class="p">,</span>
<span class="se">\</span><span class="p">}</span></code></pre></figure>

<ul>
  <li>
    <h3 id="section-7">强制刷新天气</h3>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="p">:</span><span class="k">call</span> RefreshWeather<span class="p">()</span></code></pre></figure>

